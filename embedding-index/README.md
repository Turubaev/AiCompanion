# Локальный индекс документов с эмбеддингами (AI Companion)

Пайплайн для тестовых профильных документов проекта AI Companion:

1. **Разбивка на чанки** — по параграфам (для .md — с учётом заголовков), с ограничением длины и перекрытием. Поддерживаются .md и .pdf (текст из PDF извлекается через PyMuPDF).
2. **Генерация эмбеддингов** — локально через `sentence-transformers` (модель `paraphrase-multilingual-mpnet-base-v2`, без API).
3. **Сохранение индекса** — JSON (полный дамп чанков + векторы) и FAISS (быстрый поиск по косинусной близости).

## Входные документы

По умолчанию для теста индексируется один файл из корня репозитория:

- `Test_sample.pdf`

Поддерживаются также `.md` файлы. Список задаётся в `build_index.py` (`DEFAULT_DOCS`); можно вернуть три .md профиля или комбинировать PDF и .md.

## Установка и запуск

```bash
cd embedding-index
python -m venv .venv
.venv\Scripts\activate   # Windows
# source .venv/bin/activate  # Linux/macOS
pip install -r requirements.txt
python build_index.py
```

При первом запуске `build_index.py` модель эмбеддингов будет загружена из Hugging Face (требуется интернет).

После выполнения в каталоге `embedding-index/output/` появятся:

- `index.json` — чанки, метаданные, эмбеддинги (удобно для отладки и интеграции).
- `index.faiss` — индекс FAISS для быстрого поиска.

## Поиск по индексу

```bash
python search.py "инвестиции и дивиденды"
python search.py "Kotlin Compose архитектура"
```

## Структура

| Файл | Назначение |
|------|------------|
| `chunker.py` | Разбивка текста на чанки (параграфы, предложения). |
| `pdf_loader.py` | Извлечение текста из PDF (PyMuPDF). |
| `embedder.py` | Загрузка модели и вычисление эмбеддингов. |
| `index_store.py` | Сохранение/загрузка JSON и FAISS, поиск. |
| `build_index.py` | Скрипт сборки индекса. |
| `search.py` | Консольный поиск по запросу. |

Индекс можно подключать к чату/агентам AI Companion для семантического поиска по профилю пользователя.
